<html>
<head>
<title>OIOSAML.java</title>
        <style type="text/css">
    	body {background-color: white; margin: 20px;}
    	body, tr, td {font-family: Verdana, Helvetica, sans-serif; color: #456974;}
    	div#pagecontainer {width: 80%;}
    	h1, h2, h3, h4 {color: #76c2bc; border-bottom: 1px solid #76c2bc;}
    	.monospace {font-family: monospace;}
    	legend {font-weight: bold;}
    	fieldset {margin-top: 10px; margin-bottom: 10px;}
    	span.emphasis {font-weight: bold;}
    </style>
</head>
<body>

<h1>SameSite cookie attribute</h1>
<p>
From Chrome version 80 and onwards, cookies that does not contain a SameSite attribute, will not be included in cross-domain communication. This causes several issues with SAML-based logins
</p>

<p>
For details on the planned Chrome rollout, please read the following:</p>

<a href="https://www.chromium.org/updates/same-site">https://www.chromium.org/updates/same-site</a>

<p>
If your application stores data on the servlet session before the user logs in, those data will be lost after a successful login, unless your application handles this by either
</p>

<ul>
<li>Ensuring that session cookies has the SameSite=none attribute set</li>
<li>Or adding the SessionCopyListener servlet Listener to web.xml configuration file</li>
</ul>

<p>
If your application does not create any data on the session before login, then you probably do not need to do anything, but if you experience any issues
with regards to lost session data, it is very likely related to the new Chrome behaviour, and one one the solutions outlined below should solve the issue.
</p>

<h2>Setting SameSite=none in Tomcat</h2>
Since Tomcat 9.0.21 and 8.5.42 it is possible to explicitly set the SameSite cookie attribute to a given value. One solution to the new Chrome behaviour
is simply to set the SameSite attribute to none in the Tomcat context.xml file like this

<pre>
&lt;context&gt;
  &lt;CookieProcesser sameSiteCookies="none" /&gt;
&lt;/context&gt;
</pre>

<h2>Using the SessionCopyListener functionality in OIOSAML</h2>

<p>
OIOSAML comes with a SessionCopyListener "servlet listener", that can be added to the web.xml of your application as shown below. It will store the
outgoing session when initating a SAML login or logout, and then copy the session data to the newly created session upon getting a reply from the
SAML Identity Provider.
</p>

<pre>
&lt;listener&gt;
  &lt;listener-class&gt;dk.itst.oiosaml.sp.service.session.SessionCopyListener&lt;/listener-class&gt;
&lt;/listener&gt;
</pre>

<p>
This Listener implementation the SameSiteSessionSynchronizer interface found in the OIOSAML.java framework, and ensures that session data is correctly stored during the SAML communication flows.
</p>

<p>
If you need customized functionality in your session handling, you can implement the interface yourself, and configure OIOSAML.java to use your custom class with this setting
</p>

<pre>
oiosaml-sp.samesite.handler=com.company.MyImplementationClass
</pre>

</body>
</html>
